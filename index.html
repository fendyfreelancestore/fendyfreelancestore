<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fendy Freelance Store</title>

<style>
:root{
  --primary:#e11d48;
  --card:rgba(2,6,23,.75);
  --text:#f1f5f9;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI,Arial,sans-serif;
  color:var(--text);
  min-height:100vh;
  background:
    linear-gradient(rgba(2,6,23,.25), rgba(2,6,23,.9)),
    url("bg.jpg") center/cover no-repeat fixed;
}
header{
  display:flex;
  align-items:center;
  gap:12px;
  padding:18px 30px;
  background:rgba(2,6,23,.85);
}
header img{width:42px}

.hero{text-align:center;padding:70px 20px}
.search-box input{
  width:100%;
  max-width:420px;
  padding:14px 18px;
  border-radius:14px;
  border:none;
}

/* üî¥ RUNNING TEXT */
/* ===== RUNNING TEXT FIX FINAL ===== */
.running-text{
  margin:18px auto 0;
  max-width:520px;
  overflow:hidden;
  background:rgba(225,29,72,.15);
  border:1px solid rgba(225,29,72,.4);
  border-radius:12px;
  padding:10px 0;
}

.running-track{
  display:flex;
  width:max-content;
  white-space:nowrap;
  animation:marquee 36s linear infinite;
  will-change:transform;
  color:#facc15;
  font-weight:600;
  font-size:22px;
}

@keyframes marquee{
  from{
    transform:translateX(100%);
  }
  to{
    transform:translateX(-100%);
  }
}
/* ================================ */


.container{padding:30px}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:22px;
}
.card{
  background:var(--card);
  border-radius:18px;
  padding:18px;
  cursor:pointer;
  transition:.3s;
}

/* TENGAHKAN TEKS KATEGORI, BRAND, PRODUK */
.card h3,
.card h2,
.card p,
.price,
#judul {
  text-align: center;
}

/* DETAIL PRODUK */
.card ul {
  text-align: left;        /* biar spesifikasi tetap rapi */
  margin: 12px auto;
  padding-left: 20px;
}

.card img {
  display: block;
  margin: 0 auto;
}

.card:hover{transform:translateY(-5px)}
.card img{width:100%;height:140px;object-fit:contain}
.img-produk{cursor:zoom-in}
.price{color:var(--primary);font-weight:bold}
.back{grid-column:1/-1;cursor:pointer;color:#93c5fd;font-weight:600}

.btn-cart{
  margin-top:12px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  background:#facc15;
  font-weight:bold;
}
.btn-wa{
  margin-top:12px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  background:#25D366;
  font-weight:bold;
}

/* CART */
.cart-float{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#25D366;
  color:#000;
  padding:14px 18px;
  border-radius:50px;
  font-weight:bold;
  cursor:pointer;
  z-index:999;
}
.cart-box{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  z-index:9999;
}
.cart-content{
  background:#020617;
  max-width:420px;
  margin:60px auto;
  padding:20px;
  border-radius:18px;
}
.cart-item{
  display:flex;
  justify-content:space-between;
  margin:8px 0;
}
.cart-total{margin-top:14px;font-weight:bold}

/* ZOOM */
.zoom{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.zoom img{max-width:95%;max-height:95%}

/* FOOTER */
footer{
  text-align:center;
  padding:20px 10px;
  font-size:14px;
  color:#cbd5f5;
  background:rgba(2,6,23,.85);
}
</style>
</head>

<body>

<header>
  <img src="logo.png">
  <h3>Fendy Freelance Store</h3>
</header>

<section class="hero">
  <h2>SELAMAT DATANG</h2>
  <p>Komputer ‚Ä¢ Laptop ‚Ä¢ CCTV ‚Ä¢ Smartphone ‚Ä¢ Service ‚Ä¢ Dll</p>
  <div class="search-box">
    <input id="search" placeholder="Cari produk... (contoh: laptop axioo)">
  </div>

  <!-- üî¥ TAMBAHAN: RUNNING TEXT -->
<div class="running-text">
  <div class="running-track">
    ‚ö†Ô∏è HATI-HATI PENIPUAN! 
Transaksi hanya melalui WA admin resmi FENDY FREELANCE STORE ‚Ä¢ 
    WA RESMI HANYA 082153719616 SAJA ‚Ä¢ 
    FREE ONGKIR AREA SINGKAWANG ‚Ä¢ 
    Konfirmasi pembayaran langsung ke WA admin resmi ‚Ä¢
    Ketersediaan stok tidak selalu ready. Harga dapat berubah sewaktu-waktu tanpa pemberitahuan, menyesuaikan kondisi pasar ‚Ä¢
  </div>
</div>

</section>

<section class="container">
  <h2 id="judul">Kategori Produk</h2>
  <div id="view" class="grid"></div>
</section>

<!-- CART -->
<div class="cart-float" onclick="openCart()">
  üõí Keranjang (<span id="cartCount">0</span>)
</div>

<div class="cart-box" id="cartBox">
  <div class="cart-content">
    <h3>Keranjang Belanja</h3>
    <div id="cartList"></div>
    <div class="cart-total" id="cartTotal"></div>
    <button class="btn-wa" onclick="checkoutWA()">Kirim Total ke WhatsApp</button>
    <button class="btn-wa" style="background:#64748b" onclick="closeCart()">Tutup</button>
  </div>
</div>

<div class="zoom" id="zoom"><img id="zoomImg"></div>

<footer>¬© 2026 Fendy Freelance Store</footer>

<script>
let kategori=[], brand=[], produk=[], cart=[];
const view=document.getElementById("view");
const judul=document.getElementById("judul");
const zoom=document.getElementById("zoom");
const zoomImg=document.getElementById("zoomImg");
 
/* NAV STATE */
/* ================= FIX SCROLL (TANPA GANGGU KODING LAIN) ================= */
let nav={
  level:"kategori",
  kategori:null,
  brand:null,
  scroll:{
    kategori:0,
    brand:{},
    produk:{}
  }
};

let searchState = {
  aktif: false,
  keyword: ""
};


function saveScroll(){
  if(nav.level==="kategori"){
    nav.scroll.kategori = window.scrollY;
  }
  else if(nav.level==="brand"){
    nav.scroll.brand[nav.kategori] = window.scrollY;
  }
  else if(nav.level==="produk"){
    nav.scroll.produk[nav.brand] = window.scrollY;
  }
}

function restoreScroll(){
  let y=0;

  if(nav.level==="kategori"){
    y = nav.scroll.kategori || 0;
  }
  else if(nav.level==="brand"){
    y = nav.scroll.brand[nav.kategori] || 0;
  }
  else if(nav.level==="produk"){
    y = nav.scroll.produk[nav.brand] || 0;
  }

  setTimeout(()=>window.scrollTo({top:y,behavior:"auto"}),0);
}
/* ================= END FIX SCROLL ================= */

/* LOAD CSV */
fetch("kategori.csv").then(r=>r.text()).then(t=>{
  kategori=t.trim().split("\n").slice(1).map(r=>{
    const [id,nama,desk,foto]=r.split(",");
    return {id,nama,desk,foto};
  });
  tampilKategori();
});
fetch("brand.csv").then(r=>r.text()).then(t=>{
  brand=t.trim().split("\n").slice(1).map(r=>{
    const [id,nama,kategori,foto]=r.split(",");
    return {id,nama,kategori,foto};
  });
});
fetch("produk.csv").then(r=>r.text()).then(t=>{
  produk=t.trim().split("\n").slice(1).map(r=>{
    const [id,nama,harga,brand,foto,wa,spek]=r.split(",");
    return {id,nama,harga,brand,foto,wa,spek};
  });
});

/* VIEW */
function tampilKategori(){
  nav.level="kategori";
  judul.innerText="Kategori Produk";
  view.innerHTML="";
  kategori.forEach(k=>{
    view.innerHTML+=`
      <div class="card" onclick="saveScroll();nav.kategori='${k.id}';tampilBrand('${k.id}','${k.nama}')">
        <img src="${k.foto}">
        <h3>${k.nama}</h3>
        <p>${k.desk}</p>
      </div>`;
  });
  restoreScroll();
}

function tampilBrand(id,nama){
  nav.level="brand";
  judul.innerText=nama;
  view.innerHTML=`<div class="back" onclick="navBack()">‚¨Ö Kembali</div>`;
  brand.filter(b=>b.kategori===id).forEach(b=>{
    view.innerHTML+=`
      <div class="card" onclick="saveScroll();nav.brand='${b.id}';tampilProduk('${b.id}','${b.nama}')">
        <img src="${b.foto}">
        <h3>${b.nama}</h3>
      </div>`;
  });
  restoreScroll();
}

function tampilProduk(id,nama){
  nav.level="produk";
  judul.innerText=nama;
  view.innerHTML=`<div class="back" onclick="navBack()">‚¨Ö Kembali</div>`;

  produk.filter(p=>p.brand===id).forEach(p=>{
    view.innerHTML+=`
      <div class="card" onclick="tampilDetail('${p.id}')">
        <img src="${p.foto}" class="img-produk">
        <h3>${p.nama}</h3>
        <div class="price">Rp ${Number(p.harga).toLocaleString("id-ID")}</div>
      </div>`;
  });

  restoreScroll(); // ‚úÖ BALIK KE POSISI TENGAH
}

function tampilDetail(id){
  saveScroll();
  nav.level="detail";
  const p=produk.find(x=>x.id===id);
  judul.innerText=p.nama;
  view.innerHTML=`
    <div class="back" onclick="navBack()">‚¨Ö Kembali</div>
    <div class="card">
      <img src="${p.foto}" class="img-produk">
      <h2>${p.nama}</h2>
      <div class="price">Rp ${Number(p.harga).toLocaleString("id-ID")}</div>
      <ul>${p.spek.split(";").map(s=>`<li>${s}</li>`).join("")}</ul>

      <!-- TAMBAHAN QTY + - -->
<div style="display:flex;gap:10px;justify-content:center;margin-top:10px">
  <button class="btn-cart" onclick="ubahQty('${p.id}',-1)">‚àí</button>
  <div id="qty-${p.id}" style="font-size:18px;font-weight:bold;line-height:48px">0</div>
  <button class="btn-cart" onclick="ubahQty('${p.id}',1)">+</button>
</div>
    </div>`;
}

/* NAV BACK */
function navBack(){
  // JIKA DARI DETAIL & SEBELUMNYA SEARCH
  if(nav.level==="detail" && searchState.aktif){
    nav.level="search";
    search.value = searchState.keyword;
    search.oninput();
    return;
  }

  if(nav.level==="detail"){
    nav.level="produk";
    tampilProduk(nav.brand,"");
  }
  else if(nav.level==="produk"){
    nav.level="brand";
    tampilBrand(nav.kategori,"");
  }
  else{
    nav.level="kategori";
    tampilKategori();
  }
}


/* CART */
function addCart(p){
  const i=cart.find(x=>x.id===p.id);
  i?i.qty++:cart.push({...p,qty:1});
 updateCart();
}


/* TAMBAHAN */
function ubahQty(id,delta){
const p=produk.find(x=>x.id===id);
let item=cart.find(x=>x.id===id);


if(!item && delta>0){
cart.push({...p,qty:1});
item=cart.find(x=>x.id===id);
}else if(item){
item.qty+=delta;
if(item.qty<=0){
cart=cart.filter(x=>x.id!==id);
item=null;
}
}


const el=document.getElementById("qty-"+id);
if(el) el.innerText=item?item.qty:0;
updateCart();
}


function updateCart(){
cartCount.innerText=cart.reduce((a,b)=>a+b.qty,0);
}


function openCart(){
cartBox.style.display="block";
cartList.innerHTML="";
let total=0;
cart.forEach(p=>{
const sub=p.qty*p.harga;
total+=sub;
cartList.innerHTML+=`
<div class="cart-item">
<div>${p.nama} (${p.qty})</div>
<div>Rp ${sub.toLocaleString("id-ID")}</div>
</div>`;
});
cartTotal.innerText="TOTAL: Rp "+total.toLocaleString("id-ID");
}
function closeCart(){cartBox.style.display="none"}

/* ===== INI SATU-SATUNYA BAGIAN YANG DIPERBAIKI ===== */
function checkoutWA(){
if(cart.length===0){
alert("Keranjang masih kosong");
return;
}


let text="Halo, saya mau order:%0A%0A";
let total=0;


cart.forEach((p,i)=>{
const sub=p.harga*p.qty;
total+=sub;
text+=`${i+1}. ${p.nama}%0A`;
text+=`Qty: ${p.qty}%0A`;
text+=`Subtotal: Rp ${sub.toLocaleString("id-ID")}%0A%0A`;
});


text+=`TOTAL: Rp ${total.toLocaleString("id-ID")}`;


const wa=cart[0].wa || "628xxxxxxxxxx";
window.open(`https://wa.me/${wa}?text=${text}`,"_blank");
}
/* ================================================ */

/* SEARCH */
search.oninput=function(){
  const k=this.value.toLowerCase();

  if(k.length < 2){
    searchState.aktif = false;
    return tampilKategori();
  }

  searchState.aktif = true;
  searchState.keyword = k;
  nav.level = "search";

  judul.innerText="Hasil Pencarian";
  view.innerHTML = `<div class="back" onclick="navBack()">‚¨Ö Kembali</div>`;

  produk
    .filter(p=>p.nama.toLowerCase().includes(k))
    .forEach(p=>{
      view.innerHTML+=`
        <div class="card" onclick="tampilDetail('${p.id}')">
          <img src="${p.foto}" class="img-produk">
          <h3>${p.nama}</h3>
        </div>`;
    });
};


/* ZOOM */
function zoomFoto(src){
  zoomImg.src=src;
  zoom.style.display="flex";
}
zoom.onclick=()=>zoom.style.display="none";

/* ================================================= */
/* ===== FIX FOTO PRODUK (PC & MOBILE, TANPA UBAH HTML) ===== */
/* ================================================= */
/* ===== ZOOM FOTO AKTIF HANYA DI HALAMAN DETAIL ===== */
document.addEventListener("click", function(e){
  const img = e.target.closest(".img-produk");
  if(!img) return;

  // ‚ùå selain halaman detail ‚Üí MATI
  if(nav.level !== "detail") return;

  e.preventDefault();
  e.stopPropagation();
  e.stopImmediatePropagation();
  zoomFoto(img.src);
}, true);

document.addEventListener("touchstart", function(e){
  const img = e.target.closest(".img-produk");
  if(!img) return;

  if(nav.level !== "detail") return;

  e.preventDefault();
  e.stopPropagation();
  e.stopImmediatePropagation();
  zoomFoto(img.src);
}, { capture:true, passive:false });
</script>

</body>
</html>